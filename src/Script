DROP VIEW VWLOGIN;
DROP TABLE TAREFA;
DROP TABLE USUARIO;
DROP TABLE TIPO_TAREFA;
DROP TABLE STATUS_TAREFA;


CREATE TABLE USUARIO(
   ID_USUARIO SERIAL,
   NOME_USUARIO VARCHAR(20) NOT NULL,
   EMAIL_USUARIO VARCHAR(30) NOT NULL,
   SENHA_A VARCHAR(100) NOT NULL,
   ATIVO BOOLEAN DEFAULT TRUE,
   CONSTRAINT PK_USUARIO PRIMARY KEY (ID_USUARIO),
   CONSTRAINT UK_NOME_USUARIO UNIQUE (NOME_USUARIO),
   CONSTRAINT UK_EMAIL_USUARIO UNIQUE (EMAIL_USUARIO)
);

CREATE OR REPLACE VIEW VWLOGIN 
AS 
SELECT 
   EMAIL_USUARIO,
   SENHA_A,
   ATIVO
FROM 
   USUARIO;

CREATE TABLE TIPO_TAREFA(
   ID_TIPO_TAREFA SERIAL,
   DESC_TIPO_TAREFA VARCHAR(30) NOT NULL,
   CONSTRAINT PK_TIPO_TAREFA PRIMARY KEY(ID_TIPO_TAREFA),
   CONSTRAINT UK_TIPO_TAREFA UNIQUE (DESC_TIPO_TAREFA)
);

CREATE TABLE STATUS_TAREFA(
   ID_STATUS_TAREFA SERIAL,
   DESC_STATUS_TAREFA VARCHAR(30) NOT NULL,
   CONSTRAINT PK_STATUS_TAREFA PRIMARY KEY(ID_STATUS_TAREFA),
   CONSTRAINT UK_STATUS_TAREFA UNIQUE (DESC_STATUS_TAREFA)
);


CREATE TABLE TAREFA(
   ID_TAREFA SERIAL,
   ID_TIPO_TAREFA INTEGER NOT NULL,
   ID_USUARIO INTEGER NOT NULL,
   ID_STATUS_TAREFA INTEGER NOT NULL, -- DEFINIR VALOR PADRÃO
   DESC_TAREFA VARCHAR(100) NOT NULL,
   REQUISITOS VARCHAR(500) NOT NULL,
   PRECO FLOAT NOT NULL,
   DATA_CADASTRO DATE NOT NULL,
   DATA_ENTREGA DATE NOT NULL,
   ESTIMATIVA_HORA INTEGER,
   CONSTRAINT FK_USUARIO FOREIGN KEY(ID_USUARIO) REFERENCES USUARIO(ID_USUARIO),
   CONSTRAINT FK_TIPO_TAREFA FOREIGN KEY(ID_TIPO_TAREFA) REFERENCES TIPO_TAREFA(ID_TIPO_TAREFA),
   CONSTRAINT FK_STATUS_TAREFA FOREIGN KEY(ID_STATUS_TAREFA) REFERENCES STATUS_TAREFA(ID_STATUS_TAREFA),
   CONSTRAINT PK_TAREFA PRIMARY KEY(ID_TAREFA)
);

CREATE TABLE CANDIDATOS(
	ID_TAREFA INTEGER NOT NULL,
	ID_USUARIO INTEGER NOT NULL,
	CONSTRAINT FK_TAREFA FOREIGN KEY(ID_TAREFA) REFERENCES TAREFA(ID_TAREFA),
	CONSTRAINT FK_USUARIO FOREIGN KEY(ID_USUARIO) REFERENCES USUARIO(ID_USUARIO),
	CONSTRAINT PK_CANDIDATOS PRIMARY KEY(ID_TAREFA, ID_USUARIO)
);

CREATE TABLE COMENTARIO(
	ID_COMENTARIO SERIAL,
	ID_TAREFA INTEGER NOT NULL,
	ID_USUARIO INTEGER NOT NULL,
	REL_COMENTARIO INTEGER,
	CONSTRAINT FK_TAREFA FOREIGN KEY(ID_TAREFA) REFERENCES TAREFA(ID_TAREFA),
	CONSTRAINT FK_USUARIO FOREIGN KEY(ID_USUARIO) REFERENCES USUARIO(ID_USUARIO),
	CONSTRAINT PK_COMENTARIO PRIMARY KEY(ID_COMENTARIO)
);

CREATE TABLE TIPO_NOTIFICACAO(
   ID_TIPO_NOTIFICACAO SERIAL,
   DESC_TIPO_NOTIFICACAO VARCHAR(100) NOT NULL,
   CONSTRAINT PK_TIPO_NOTIFICACAO PRIMARY KEY(ID_TIPO_NOTIFICACAO),
   CONSTRAINT UK_TIPO_NOTIFICACAO UNIQUE (DESC_TIPO_NOTIFICACAO)
);

CREATE TABLE NOTIFICACAO(
   ID_NOTIFICACAO SERIAL,
   ID_TIPO_NOTIFICACAO INTEGER NOT NULL,
   ID_TAREFA INTEGER NOT NULL,
   NOME_REMETENTE VARCHAR(30) NOT NULL,
   ID_DESTINATARIO INTEGER NOT NULL,
   VISUALIZADO BOOLEAN DEFAULT FALSE,
   DATA_CADASTRO DATE NOT NULL,
   CONSTRAINT PK_NOTIFICACAO PRIMARY KEY (ID_NOTIFICACAO),
   CONSTRAINT FK_TAREFA FOREIGN KEY(ID_TAREFA) REFERENCES TAREFA(ID_TAREFA),
   CONSTRAINT FK_TIPO_NOTIFICACAO FOREIGN KEY(ID_TIPO_NOTIFICACAO) REFERENCES TIPO_NOTIFICACAO(ID_TIPO_NOTIFICACAO)
);